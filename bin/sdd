#!/usr/bin/env bash

# Main executable of the sdd program

set -eo pipefail

SCRIPTDIR="$(readlink -f "$(dirname "${BASH_SOURCE[0]}")")"

# shellcheck source=../lib/sdd/framework/utils.bash
source "$SCRIPTDIR"/../lib/sdd/framework/utils.bash

SDD_INSTALL_PREFIX=${SDD_INSTALL_PREFIX:-$HOME/.local}
export SDD_INSTALL_PREFIX
mkdir -p "$SDD_INSTALL_PREFIX"/bin

SDD_DATA_DIR=${XDG_DATA_DIR:-$HOME/.local/share}/sdd
export SDD_DATA_DIR
mkdir -p "$SDD_DATA_DIR"/apps

main() {
    local command="$1"

    case "$command" in
        install|i)
            shift
            utils_install "$@"
            ;;
        upgrade|up)
            shift
            utils_upgrade "$@"
            ;;
        uninstall|un)
            shift
            utils_uninstall "$@"
            ;;
        list|l)
            shift
            utils_list "$@"
            ;;
        --help|-h)
            utils_usage
            ;;
        --version|-v)
            utils_version
            ;;
        ?*)
            printf 'Unknown command "%s"\n' "$command" >&2
            exit 2
            ;;
        *)
            utils_usage
    esac

    exit 0
}

main "$@"

exit 1
